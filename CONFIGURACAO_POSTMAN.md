# Guia Completo de Configuração do Postman - AV2 ## Passo 1: Importar a Coleção ### Opção A: Importar arquivo JSON 1. Abra o Postman 2. Clique em **"Import"** (canto superior esquerdo) 3. Clique em **"Upload Files"** 4. Selecione o arquivo: `av2-api/Postman_Collection_AV2.json` 5. Clique em **"Import"** ### Opção B: Criar coleção manualmente Siga os passos abaixo para criar cada request. --- ## Passo 2: Configurar Variáveis de Ambiente ### Criar Environment 1. Clique no ícone de **"Environments"** (canto superior direito) 2. Clique em **"+"** para criar novo environment 3. Nome: `AV2-Local` 4. Adicione as variáveis: | Variable | Initial Value | Current Value | |----------|---------------|---------------| | `base_url`` | `http://localhost:8081` | `http://localhost:8081` | | `jwt` | (deixe vazio) | (será preenchido automaticamente) | 5. Clique em **"Save"** 6. Selecione o environment `AV2-Local` no dropdown (canto superior direito) --- ## Passo 3: Configurar Cada Request ### Request 1: Login (POST /auth/login) **Configuração:** - **Nome:** `Login` - **Método:** `POST` - **URL:** `{{base_url}}/auth/login` **Headers:** ``` Content-Type: application/json ``` **Body (raw JSON):** ```json { "email": "admin@fmp.br", "senha": "123456" } ``` **Scripts (Tests tab):** ```javascript if (pm.response.code === 200) { var jsonData = pm.response.json(); pm.environment.set("jwt", jsonData.token); console.log("Token salvo:", jsonData.token); // Teste automático pm.test("Status code is 200", function () { pm.response.to.have.status(200); }); pm.test("Response has token", function () { pm.expect(jsonData).to.have.property('token'); pm.expect(jsonData).to.have.property('type', 'Bearer'); pm.expect(jsonData).to.have.property('expiresIn', 3600); }); } ``` **Resposta esperada (200 OK):** ```json { "type": "Bearer", "token": "eyJhbGciOiJIUzI1NiJ9...", "expiresIn": 3600 } ``` --- ### Request 2: GET /aluno (Listar com Token) **Configuração:** - **Nome:** `GET /aluno (Listar)` - **Método:** `GET` - **URL:** `{{base_url}}/aluno` **Headers:** ``` Authorization: Bearer {{jwt}} Content-Type: application/json ``` **Scripts (Tests tab):** ```javascript pm.test("Status code is 200", function () { pm.response.to.have.status(200); }); pm.test("Response is array", function () { pm.response.to.be.json; pm.response.to.have.jsonBody(); const jsonData = pm.response.json(); pm.expect(jsonData).to.be.an('array'); }); ``` **Resposta esperada (200 OK):** ```json [ { "id": 1, "nome": "João Silva", "idade": 25, "cpf": "12345678900" }, { "id": 2, "nome": "Maria Santos", "idade": 22, "cpf": "98765432100" } ] ``` --- ### Request 3: GET /aluno (Sem Token - 401) **Configuração:** - **Nome:** `GET /aluno (Sem Token - 401)` - **Método:** `GET` - **URL:** `{{base_url}}/aluno` **Headers:** (Não adicione o header Authorization) **Scripts (Tests tab):** ```javascript pm.test("Status code is 401", function () { pm.response.to.have.status(401); }); pm.test("Response has error message", function () { const jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('status', 401); pm.expect(jsonData).to.have.property('error', 'Unauthorized'); }); ``` **Resposta esperada (401 Unauthorized):** ```json { "status": 401, "error": "Unauthorized", "message": "Token de autenticação necessário", "path": "/aluno", "timestamp": "2025-11-09T16:00:00.000Z" } ``` --- ### Request 4: POST /aluno (Criar - 201) **Configuração:** - **Nome:** `POST /aluno (Criar)` - **Método:** `POST` - **URL:** `{{base_url}}/aluno` **Headers:** ``` Authorization: Bearer {{jwt}} Content-Type: application/json ``` **Body (raw JSON):** ```json { "nome": "Novo Aluno Teste", "idade": 20, "cpf": "11122233344" } ``` **Scripts (Tests tab):** ```javascript pm.test("Status code is 201", function () { pm.response.to.have.status(201); }); pm.test("Response has aluno data", function () { const jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('id'); pm.expect(jsonData).to.have.property('nome', 'Novo Aluno Teste'); pm.expect(jsonData).to.have.property('cpf', '11122233344'); }); ``` **Resposta esperada (201 Created):** ```json { "id": 3, "nome": "Novo Aluno Teste", "idade": 20, "cpf": "11122233344" } ``` --- ### Request 5: POST /aluno (CPF Duplicado - 409) **Configuração:** - **Nome:** `POST /aluno (CPF Duplicado - 409)` - **Método:** `POST` - **URL:** `{{base_url}}/aluno` **Headers:** ``` Authorization: Bearer {{jwt}} Content-Type: application/json ``` **Body (raw JSON):** ```json { "nome": "Outro Aluno", "idade": 25, "cpf": "11122233344" } ``` **Scripts (Tests tab):** ```javascript pm.test("Status code is 409", function () { pm.response.to.have.status(409); }); pm.test("Response has conflict message", function () { const jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('status', 409); pm.expect(jsonData).to.have.property('error', 'Conflict'); pm.expect(jsonData.message).to.include('cpf'); }); ``` **Resposta esperada (409 Conflict):** ```json { "status": 409, "error": "Conflict", "message": "Já existe uma pessoa com cpf", "path": "/aluno", "timestamp": "2025-11-09T16:00:00.000Z" } ``` --- ### Request 6: GET /aluno/999 (404 Not Found) **Configuração:** - **Nome:** `GET /aluno/999 (404)` - **Método:** `GET` - **URL:** `{{base_url}}/aluno/999` **Headers:** ``` Authorization: Bearer {{jwt}} Content-Type: application/json ``` **Scripts (Tests tab):** ```javascript pm.test("Status code is 404", function () { pm.response.to.have.status(404); }); pm.test("Response has not found message", function () { const jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('status', 404); pm.expect(jsonData).to.have.property('error', 'Não encontrado'); pm.expect(jsonData.message).to.include('999'); }); ``` **Resposta esperada (404 Not Found):** ```json { "status": 404, "error": "Não encontrado", "message": "Aluno não encontrado com id: 999", "path": "/aluno/999", "timestamp": "2025-11-09T16:00:00.000Z" } ``` --- ### Request 7: POST /auth/login (Credenciais Erradas - 401) **Configuração:** - **Nome:** `POST /auth/login (Credenciais Erradas - 401)` - **Método:** `POST` - **URL:** `{{base_url}}/auth/login` **Headers:** ``` Content-Type: application/json ``` **Body (raw JSON):** ```json { "email": "admin@fmp.br", "senha": "senhaerrada" } ``` **Scripts (Tests tab):** ```javascript pm.test("Status code is 401", function () { pm.response.to.have.status(401); }); pm.test("Response has unauthorized message", function () { const jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('status', 401); pm.expect(jsonData).to.have.property('error', 'Unauthorized'); pm.expect(jsonData.message).to.include('Credenciais'); }); ``` **Resposta esperada (401 Unauthorized):** ```json { "status": 401, "error": "Unauthorized", "message": "Credenciais inválidas", "path": "/auth/login", "timestamp": "2025-11-09T16:00:00.000Z" } ``` --- ### Request 8: GET /aluno (CORS Test) **Configuração:** - **Nome:** `GET /aluno (CORS Test)` - **Método:** `OPTIONS` - **URL:** `{{base_url}}/aluno` **Headers:** ``` Origin: http://localhost:3000 Access-Control-Request-Method: GET Access-Control-Request-Headers: Authorization ``` **Scripts (Tests tab):** ```javascript pm.test("Status code is 200 or 204", function () { pm.expect([200, 204]).to.include(pm.response.code); }); pm.test("CORS headers present", function () { pm.response.to.have.header("Access-Control-Allow-Origin", "http://localhost:3000"); pm.response.to.have.header("Access-Control-Allow-Methods"); pm.response.to.have.header("Access-Control-Allow-Credentials", "true"); }); ``` **Resposta esperada:** Headers devem incluir: ``` Access-Control-Allow-Origin: http://localhost:3000 Access-Control-Allow-Methods: GET,POST,PUT,DELETE,OPTIONS Access-Control-Allow-Credentials: true ``` --- ## Passo 4: Executar Testes em Sequência ### Opção A: Runner do Postman 1. Clique em **"Runner"** (canto superior direito) 2. Selecione a coleção `AV2-SpringBoot` 3. Selecione o environment `AV2-Local` 4. **IMPORTANTE:** Execute o request "Login" primeiro 5. Clique em **"Run AV2-SpringBoot"** ### Opção B: Executar Manualmente 1. Execute o request **"Login"** primeiro 2. Verifique se o token foi salvo (vá em Environments → AV2-Local → veja a variável `jwt`) 3. Execute os outros requests na ordem desejada --- ## Checklist de Configuração - [ ] Coleção importada ou criada - [ ] Environment `AV2-Local` criado - [ ] Variável `base_url` configurada - [ ] Variável `jwt` criada (será preenchida automaticamente) - [ ] Environment selecionado no dropdown - [ ] Request "Login" configurado com script para salvar token - [ ] Todos os outros requests configurados com `{{jwt}}` no header Authorization - [ ] Scripts de teste adicionados em cada request --- ## Troubleshooting ### Token não está sendo salvo - Verifique se o script no request "Login" está correto - Verifique se o environment está selecionado - Execute o request "Login" novamente ### Erro 401 em todos os requests - Execute o request "Login" primeiro - Verifique se a variável `jwt` foi preenchida no environment - Verifique se o header Authorization está usando `Bearer {{jwt}}` ### Erro CORS - Verifique se o header `Origin: http://localhost:3000` está presente - Verifique se a aplicação está rodando - Verifique se o `CorsConfig` está configurado corretamente --- ## Coleção Completa JSON A coleção já está pronta no arquivo `Postman_Collection_AV2.json`. Basta importá-la! --- ## Pronto! Agora você pode executar todos os testes no Postman. Lembre-se: 1. **Sempre execute "Login" primeiro** 2. O token será salvo automaticamente 3. Os outros requests usarão o token automaticamente 