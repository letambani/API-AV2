# Configuração Completa do Postman - AV2 ## Resumo Rápido 1. **Importar:** `Postman_Collection_AV2.json` 2. **Criar Environment:** `AV2-Local` com variável `jwt` 3. **Executar:** Request "Login" primeiro 4. **Pronto!** Token salvo automaticamente --- ## PASSO 1: Importar Coleção ### Método 1: Importar Arquivo ``` 1. Postman → Import (canto superior esquerdo) 2. Upload Files 3. Selecione: av2-api/Postman_Collection_AV2.json 4. Import ``` ### Método 2: Criar Manualmente Siga os comandos abaixo para cada request. --- ## PASSO 2: Criar Environment ### Criar Environment "AV2-Local" ``` 1. Clique no ícone (Environments) - canto superior direito 2. Clique em "+" (Create Environment) 3. Nome: AV2-Local 4. Adicione variável: - Variable: jwt - Initial Value: (vazio) - Current Value: (vazio) 5. Save 6. Selecione "AV2-Local" no dropdown ``` --- ## PASSO 3: Configurar Requests ### REQUEST 1: Login (OBRIGATÓRIO - Execute Primeiro!) **Configuração:** ``` Nome: Login Método: POST URL: http://localhost:8081/auth/login ``` **Headers:** ``` Content-Type: application/json ``` **Body (raw JSON):** ```json { "email": "admin@fmp.br", "senha": "123456" } ``` **Scripts (Tests tab):** ```javascript // Testes automáticos pm.test('Status code is 200', function () { pm.response.to.have.status(200); }); pm.test('Response has token', function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('token'); pm.expect(jsonData).to.have.property('type', 'Bearer'); pm.expect(jsonData).to.have.property('expiresIn', 3600); }); // Salvar token automaticamente if (pm.response.code === 200) { var jsonData = pm.response.json(); pm.environment.set('jwt', jsonData.token); console.log(' Token salvo:', jsonData.token.substring(0, 50) + '...'); } ``` **Resposta esperada:** ```json { "type": "Bearer", "token": "eyJhbGciOiJIUzI1NiJ9...", "expiresIn": 3600 } ``` --- ### REQUEST 2: GET /aluno (Listar com Token) **Configuração:** ``` Nome: GET /aluno (Listar) Método: GET URL: http://localhost:8081/aluno ``` **Headers:** ``` Authorization: Bearer {{jwt}} ``` **Scripts (Tests tab):** ```javascript pm.test("Status code is 200", function () { pm.response.to.have.status(200); }); pm.test("Response is array", function () { const jsonData = pm.response.json(); pm.expect(jsonData).to.be.an('array'); }); ``` --- ### REQUEST 3: GET /aluno (Sem Token - 401) **Configuração:** ``` Nome: GET /aluno (Sem Token - 401) Método: GET URL: http://localhost:8081/aluno ``` **Headers:** (Não adicione nenhum header) **Scripts (Tests tab):** ```javascript pm.test("Status code is 401", function () { pm.response.to.have.status(401); }); pm.test("Response has error", function () { const jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('status', 401); pm.expect(jsonData).to.have.property('error', 'Unauthorized'); }); ``` --- ### REQUEST 4: POST /aluno (Criar - 201) **Configuração:** ``` Nome: POST /aluno (Criar) Método: POST URL: http://localhost:8081/aluno ``` **Headers:** ``` Authorization: Bearer {{jwt}} Content-Type: application/json ``` **Body (raw JSON):** ```json { "nome": "Novo Aluno Teste", "idade": 20, "cpf": "11122233344" } ``` **Scripts (Tests tab):** ```javascript pm.test("Status code is 201", function () { pm.response.to.have.status(201); }); pm.test("Response has aluno data", function () { const jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('id'); pm.expect(jsonData).to.have.property('nome'); pm.expect(jsonData).to.have.property('cpf'); }); ``` --- ### REQUEST 5: POST /aluno (CPF Duplicado - 409) **Configuração:** ``` Nome: POST /aluno (CPF Duplicado - 409) Método: POST URL: http://localhost:8081/aluno ``` **Headers:** ``` Authorization: Bearer {{jwt}} Content-Type: application/json ``` **Body (raw JSON):** ```json { "nome": "Outro Aluno", "idade": 25, "cpf": "11122233344" } ``` **Scripts (Tests tab):** ```javascript pm.test("Status code is 409", function () { pm.response.to.have.status(409); }); pm.test("Response has conflict message", function () { const jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('status', 409); pm.expect(jsonData).to.have.property('error', 'Conflict'); pm.expect(jsonData.message).to.include('cpf'); }); ``` --- ### REQUEST 6: GET /aluno/999 (404 Not Found) **Configuração:** ``` Nome: GET /aluno/999 (404) Método: GET URL: http://localhost:8081/aluno/999 ``` **Headers:** ``` Authorization: Bearer {{jwt}} ``` **Scripts (Tests tab):** ```javascript pm.test("Status code is 404", function () { pm.response.to.have.status(404); }); pm.test("Response has not found message", function () { const jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('status', 404); pm.expect(jsonData).to.have.property('error', 'Não encontrado'); }); ``` --- ### REQUEST 7: POST /auth/login (Credenciais Erradas - 401) **Configuração:** ``` Nome: POST /auth/login (Credenciais Erradas - 401) Método: POST URL: http://localhost:8081/auth/login ``` **Headers:** ``` Content-Type: application/json ``` **Body (raw JSON):** ```json { "email": "admin@fmp.br", "senha": "senhaerrada" } ``` **Scripts (Tests tab):** ```javascript pm.test("Status code is 401", function () { pm.response.to.have.status(401); }); pm.test("Response has unauthorized message", function () { const jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('status', 401); pm.expect(jsonData).to.have.property('error', 'Unauthorized'); }); ``` --- ### REQUEST 8: CORS Test (OPTIONS) **Configuração:** ``` Nome: GET /aluno (CORS Test) Método: OPTIONS URL: http://localhost:8081/aluno ``` **Headers:** ``` Origin: http://localhost:3000 Access-Control-Request-Method: GET Access-Control-Request-Headers: Authorization ``` **Scripts (Tests tab):** ```javascript pm.test("CORS headers present", function () { pm.response.to.have.header("Access-Control-Allow-Origin", "http://localhost:3000"); pm.response.to.have.header("Access-Control-Allow-Methods"); pm.response.to.have.header("Access-Control-Allow-Credentials", "true"); }); ``` --- ## Ordem de Execução Recomendada 1. **Login** → Obtém token (obrigatório primeiro!) 2. **GET /aluno (Listar)** → Lista alunos 3. **GET /aluno (Sem Token)** → Testa 401 4. **POST /aluno (Criar)** → Cria aluno 5. **POST /aluno (CPF Duplicado)** → Testa 409 6. **GET /aluno/999** → Testa 404 7. **POST /auth/login (Credenciais Erradas)** → Testa 401 8. **CORS Test** → Verifica CORS --- ## Credenciais ``` Email: admin@fmp.br Senha: 123456 ``` --- ## Checklist de Configuração - [ ] Coleção importada (`Postman_Collection_AV2.json`) - [ ] Environment `AV2-Local` criado - [ ] Variável `jwt` adicionada ao environment - [ ] Environment selecionado no dropdown - [ ] Request "Login" executado primeiro - [ ] Token salvo automaticamente (verificar em Environments) - [ ] Outros requests usando `{{jwt}}` no header Authorization --- ## Troubleshooting ### Token não está sendo salvo 1. Verifique se o environment está selecionado 2. Execute o request "Login" novamente 3. Abra o console: View → Show Postman Console 4. Verifique se há erros no console ### Erro 401 em todos os requests 1. Execute o request "Login" primeiro 2. Verifique se `{{jwt}}` está no header Authorization 3. Verifique se o token não expirou (faça login novamente) 4. Verifique se a variável `jwt` foi preenchida no environment ### Erro de conexão 1. Verifique se a aplicação está rodando: `http://localhost:8081` 2. Teste: `curl http://localhost:8081/health` 3. Verifique firewall/antivírus --- ## Resumo dos Status Codes | Request | Status Esperado | Descrição | |----------|-------------------|----------| | POST /auth/login | 200 OK | Login com credenciais corretas | | GET /aluno (com token) | 200 OK | Lista alunos | | GET /aluno (sem token) | 401 Unauthorized | Sem autenticação | | POST /aluno (criar) | 201 Created | Aluno criado | | POST /aluno (CPF duplicado) | 409 Conflict | CPF já existe | | GET /aluno/999 | 404 Not Found | ID não encontrado | | POST /auth/login (errado) | 401 Unauthorized | Credenciais inválidas | | OPTIONS /aluno (CORS) | 200/204 OK | CORS configurado | --- ## Pronto! Agora você tem tudo configurado no Postman. Basta: 1. Importar a coleção 2. Criar o environment 3. Executar o Login 4. Executar os outros testes! **Arquivos criados:** - `Postman_Collection_AV2.json` - Coleção pronta para importar - `CONFIGURACAO_POSTMAN.md` - Guia detalhado - `POSTMAN_QUICK_START.md` - Guia rápido - `COMANDOS_POSTMAN.txt` - Comandos em texto puro 